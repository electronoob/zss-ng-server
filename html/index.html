<html>
    <head>
        <style>
            canvas {
                background-color: #fff;
            }
            body {
                margin: 0px;
                padding: 0px;
                background-color: #000;
            }
        </style>


<script>
let m = {x: 0, y: 0};
let r = {x:0,y:0};
let t1 = null;

const socket = new WebSocket('ws://localhost:8080');
socket.binaryType = "arraybuffer";
socket.addEventListener('open', function (event) {
    setInterval(function(){
        let b = new ArrayBuffer(5);
        let dv = new DataView(b);
        dv.setUint8(0, 1);
        dv.setUint16(1, m.x);
        dv.setUint16(3, m.y);
        socket.send(b);
    },5);
    t1 = setInterval(() => {
        ctx.fillRect(r.x,r.y,2,2);
    },10);
});
socket.addEventListener('message', function (event) {
    if (typeof event.data === 'string') {
    } else {
        let ab = new Uint8Array(event.data).buffer;
        let dv = new DataView(ab);
        let op = dv.getUint8(0);
        switch(op){
            case 1:
                r.x = dv.getUint16(1);
                r.y = dv.getUint16(3);
                break;
        }
    }
});
</script>
   </head>
   <body>
<canvas id=c width=400px height=400px></canvas>
<script>
    let c = document.getElementById("c");
    let ctx = c.getContext("2d");
    c.addEventListener('mousemove', function(e) {
        m.x = e.clientX
        m.y = e.clientY;
    });
</script>
</body>
</html>
